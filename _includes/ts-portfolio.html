{% comment %}
  Tillerstead Portfolio Section
  - Displays portfolio items from site.data.portfolio
  - TCNA/NJ HIC compliant, accessible, conversion-optimized
  - Reference: /.ai/OUTPUT_RULES.md, /.ai/STYLE.md
{% endcomment %}

{% assign portfolio_items = site.data.portfolio.projects | default: site.data.portfolio_highlights.items %}
{% assign section_id = include.section_id | default: 'ts-portfolio' %}
{% assign heading_id = section_id | append: '-title' %}

<section class="ts-portfolio ts-section" id="{{ section_id }}" aria-labelledby="{{ heading_id }}" style="background-image: url('/assets/img/patterns/herringbone-subtle.svg'); background-size: 320px 160px; background-position: center;">
  <div class="container">
    <header class="ts-portfolio__header">
      <p class="eyebrow text-accent">Documented Work</p>
      <h2 id="{{ heading_id }}" class="heading-2 text-primary">
        TCNA-Compliant Installations—Photo-Documented from Substrate to Grout
      </h2>
      <p class="lead">
        Every project includes substrate assessment, flood-tested waterproofing, and final inspection documentation. No hidden work, no assumptions—just transparent, code-compliant craftsmanship.
      </p>
    </header>

    {% if portfolio_items and portfolio_items.size > 0 %}
      <div class="ts-portfolio__grid">
        {% for item in portfolio_items limit:9 %}
          <article class="ts-portfolio__item card ts-card">
            {% if item.image or item.images %}
              {% assign portfolio_image = item.image | default: item.images[0].src %}
              {% assign portfolio_webp = portfolio_image | replace: '.jpg', '.webp' | replace: '.png', '.webp' %}
              {% assign portfolio_alt = item.alt | default: item.images[0].alt | default: item.title | append: ' - TCNA-compliant tile installation by Tillerstead, NJ HIC #13VH10808800' %}
              
              <figure class="ts-portfolio__figure">
                <picture>
                  <source type="image/webp" srcset="{{ portfolio_webp | relative_url }}">
                  <img src="{{ portfolio_image | relative_url }}" 
                       alt="{{ portfolio_alt }}" 
                       loading="lazy" 
                       decoding="async">
                </picture>
              </figure>
            {% endif %}

            <div class="ts-portfolio__content">
              {% if item.title %}
                <h3 class="heading-4 text-primary">{{ item.title }}</h3>
              {% endif %}
              
              {% if item.description %}
                <p>{{ item.description }}</p>
              {% endif %}

              {% if item.specs or item.details %}
                <ul class="ts-portfolio__specs" role="list">
                  {% assign specs = item.specs | default: item.details %}
                  {% for spec in specs limit:3 %}
                    <li><small>{{ spec }}</small></li>
                  {% endfor %}
                </ul>
              {% endif %}

              {% if item.url %}
                <a href="{{ item.url | relative_url }}" class="btn btn--sm btn--ghost">
                  View Project Details
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="ts-portfolio__placeholder">
        <p class="lead text-center">Portfolio items coming soon. Contact us to see recent work examples.</p>
        <div class="btn-row center">
          <a href="{{ '/contact/' | relative_url }}" class="btn btn--primary">Request Project Photos</a>
        </div>
      </div>
    {% endif %}

    <nav class="ts-portfolio__actions" aria-label="Portfolio actions">
      <a href="{{ '/contact/' | relative_url }}" class="btn btn--primary">
        Request TCNA-Compliant Estimate
      </a>
      <a href="{{ '/services/' | relative_url }}" class="btn btn--ghost">
        View All Services
      </a>
    </nav>

    <p class="ts-portfolio__note">
      <small>
        All work performed to TCNA 2024 standards with full NJ HIC compliance. 
        Documentation includes substrate prep photos, waterproofing flood tests, and final inspection records.
      </small>
    </p>
  </div>
</section>
