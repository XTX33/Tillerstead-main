{% comment %}
Testimonials include
- Reads from `include.reviews` when provided, otherwise `site.data.reviews.reviews`.
- Optional params: heading, eyebrow, limit.
- quote_html should be HTML-safe snippets sourced from Thumbtack via scripts/sync_thumbtack_reviews.js.
{% endcomment %}

{% assign reviews = include.reviews | default: site.data.reviews.reviews | default: [] %}
{% if include.limit %}
  {% assign reviews = reviews | slice: 0, include.limit %}
{% endif %}

{% assign heading = include.heading | default: 'Client testimonials' %}
{% assign eyebrow = include.eyebrow | default: 'Verified reviews' %}

{% assign section_id = include.section_id | default: 'ts-testimonials' %}
{% assign heading_id = include.heading_id | default: section_id | append: '-title' %}

<section class="ts-testimonials ts-section" aria-labelledby="{{ heading_id }}">
  <div class="container">
    <header class="ts-testimonials__header section-header">
      {% if eyebrow %}<p class="eyebrow text-accent">{{ eyebrow }}</p>{% endif %}
      <h2 id="{{ heading_id }}" class="heading-2">{{ heading }}</h2>
    </header>

    {% if reviews and reviews.size > 0 %}
      <div class="ts-testimonials__grid" role="list">
        {% for review in reviews %}
          {% assign rating_value = review.rating | default: 5 %}
          {% assign rating_max = review.rating_max | default: 5 %}
          <article class="ts-testimonial" role="listitem" aria-label="Testimonial from {{ review.author | default: 'Client' }}">
            <blockquote class="ts-testimonial__quote">
              <div class="ts-testimonial__quote-text">{{ review.quote_html | markdownify }}</div>
            </blockquote>

            <div class="ts-testimonial__rating" aria-label="Rated {{ rating_value }} out of {{ rating_max }} stars">
              <span class="sr-only">Rated {{ rating_value }} out of {{ rating_max }} stars</span>
              <div class="ts-testimonial__stars" aria-hidden="true">
                {% for i in (1..rating_max) %}
                  <span class="ts-testimonial__star{% if i <= rating_value %} ts-testimonial__star--filled{% endif %}">
                    {% if i <= rating_value %}★{% else %}☆{% endif %}
                  </span>
                {% endfor %}
              </div>
            </div>

            <footer class="ts-testimonial__meta" aria-label="Review details">
              <p class="ts-testimonial__byline">
                {% if review.author %}<span class="ts-testimonial__author">{{ review.author }}</span>{% endif %}
                {% if review.location %}<span class="ts-testimonial__location"> · {{ review.location }}</span>{% endif %}
                {% if review.job_type %}<span class="ts-testimonial__job"> · {{ review.job_type }}</span>{% endif %}
              </p>
              {% if review.badges and review.badges.size > 0 %}
                <ul class="ts-testimonial__badges" aria-label="Review badges">
                  {% for badge in review.badges %}
                    <li class="ts-testimonial__badge">{{ badge }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </footer>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="ts-testimonials__empty">Reviews will appear here once they are synced.</p>
    {% endif %}
  </div>
</section>
