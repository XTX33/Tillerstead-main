{%- comment -%}
Tillerstead Breadcrumb Navigation
• TCNA/NJ HIC-compliant, Schema.org BreadcrumbList structured data
• Hidden on home/root-level/single pages, or if `breadcrumb: false`
• Accessible navigation with ARIA landmarks and keyboard support
• Conversion-optimized with clear, trustworthy paths
{%- endcomment -%}

{%- assign url = page.url | default: "/" -%}
{%- assign is_home_page = url == "/" or url == "/index.html" or page.is_home == true or page.layout == "home" -%}

{%- assign path = url | replace: 'index.html', '' -%}
{%- assign segments = path | split: '/' -%}
{%- assign segment_count = 0 -%}
{%- for segment in segments -%}
  {%- unless segment == '' -%}
    {%- assign segment_count = segment_count | plus: 1 -%}
  {%- endunless -%}
{%- endfor -%}

{%- assign is_root_leaf = segment_count <= 1 -%}
{%- assign show_breadcrumbs = page.breadcrumb != false and is_home_page == false and is_root_leaf == false -%}

{%- if show_breadcrumbs -%}
  {%- assign clean_segments = '' | split: '' -%}
  {%- for segment in segments -%}
    {%- unless segment == '' -%}
      {%- assign clean_segments = clean_segments | push: segment -%}
    {%- endunless -%}
  {%- endfor -%}

  <nav class="ts-breadcrumbs" aria-label="Breadcrumb navigation" role="navigation">
    <ol class="ts-breadcrumbs__list" itemscope itemtype="https://schema.org/BreadcrumbList" role="list">
      {%- assign position = 1 -%}
      <li class="ts-breadcrumbs__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="ts-breadcrumbs__link" href="{{ '/' | relative_url }}" itemprop="item" aria-label="Home">
          <span itemprop="name">Home</span>
        </a>
        <meta itemprop="position" content="{{ position }}">
        <span class="ts-breadcrumbs__separator" aria-hidden="true">/</span>
      </li>
      {%- assign position = position | plus: 1 -%}

      {%- assign current_path = "" -%}
      {%- for segment in clean_segments -%}
        {%- assign current_path = current_path | append: "/" | append: segment -%}
        {%- assign is_last = forloop.last -%}

        {%- if is_last -%}
          {%- assign label = page.breadcrumb_title | default: page.title | default: segment | replace: '-', ' ' | capitalize -%}
        {%- else -%}
          {%- assign label = segment | replace: '-', ' ' | capitalize -%}
        {%- endif -%}

        {%- assign crumb_href = current_path | append: "/" | relative_url -%}
        <li class="ts-breadcrumbs__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          {%- if is_last -%}
            <span class="ts-breadcrumbs__current" aria-current="page" itemprop="name">{{ label }}</span>
          {%- else -%}
            <a class="ts-breadcrumbs__link" href="{{ crumb_href }}" itemprop="item" aria-label="{{ label }}">
              <span itemprop="name">{{ label }}</span>
            </a>
            <span class="ts-breadcrumbs__separator" aria-hidden="true">/</span>
          {%- endif -%}
          <meta itemprop="position" content="{{ position }}">
        </li>
        {%- assign position = position | plus: 1 -%}
      {%- endfor -%}
    </ol>
  </nav>
{%- endif -%}
