{% assign summary = include.summary | default: page.services_summary | default: 'Every scope starts with layout math, flood-tested waterproofing, and photos you can hand to a lender, tenant, or GC. No shortcuts, no sliver tiles unless the plan leaves no other choice.' %}
{% assign services = include.services | default: page.services | default: site.data.services.services %}
{% assign services_gallery = include.gallery | default: page.services_gallery %}
{% assign section_id = include.section_id | default: 'ts-services' %}
{% assign heading_id = include.heading_id | default: section_id | append: '-title' %}

{%- comment -%}
  CORE CAPABILITIES section for Tillerstead homepage.
  Supports:
  - String format: "paint|Title|Description|/url|Tagline|Details"
  - Object format: { "icon": "...", "title": "...", "description": "...", "url": "...", "tagline": "...", "details": "..." }
{%- endcomment -%}

<section class="ts-services ts-section" id="{{ section_id }}" aria-labelledby="{{ heading_id }}">
  <div class="container">
    <header class="ts-services__header">
      <p class="eyebrow text-accent">Precise layouts & tight, waterproof tile assemblies</p>
      <h2 id="{{ heading_id }}" class="heading-2 text-primary">
        Precise tile installations for homeowners, landlords &amp; partner contractors.
      </h2>
      <p class="lead">{{ summary }}</p>
    </header>

    {% if services and services != empty %}
      <ul class="ts-services__grid" role="list">
        {% for raw in services %}
          {%- assign service_tagline = raw.tagline -%}
          {%- assign service_details = raw.details | default: raw.points -%}

          {%- if raw contains '|' -%}
            {%- assign parts = raw | split: '|' -%}
            {%- assign service_icon_key   = parts[0] | strip -%}
            {%- assign service_title      = parts[1] | strip -%}
            {%- assign service_description= parts[2] | strip -%}
            {%- assign service_url        = parts[3] | strip -%}
            {%- if parts.size > 4 -%}
              {%- assign service_tagline = parts[4] | strip -%}
            {%- endif -%}
            {%- if parts.size > 5 -%}
              {%- assign service_details = parts[5] | strip -%}
            {%- endif -%}
          {%- else -%}
            {%- assign service_icon_key   = raw.icon -%}
            {%- assign service_title      = raw.title -%}
            {%- assign service_description= raw.description -%}
            {%- assign service_url        = raw.url -%}
          {%- endif -%}

          {%- assign service_details_list = service_details -%}
          {%- if service_details_list and service_details_list contains '|' -%}
            {%- assign service_details_list = service_details_list | split: '|' -%}
          {%- elsif service_details_list and service_details_list contains ';' -%}
            {%- assign service_details_list = service_details_list | split: ';' -%}
          {%- elsif service_details_list and service_details_list contains ',' -%}
            {%- assign service_details_list = service_details_list | split: ',' -%}
          {%- endif -%}

          <li>
            {% include ts-service-card.html
              icon=service_icon_key
              title=service_title
              description=service_description
              tagline=service_tagline
              details=service_details_list
              url=service_url %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <nav class="ts-services__actions" aria-label="Service actions">
      <a class="btn btn--primary" href="{{ '/contact/' | relative_url }}">Book a waterproofing walkthrough</a>
      <a class="btn btn--ghost" href="{{ '/portfolio/' | relative_url }}">Review recent math &amp; installs</a>
    </nav>

    <p class="ts-services__note">
      TCNA-guided installs, daily documentation, and respectful job-sites from demo through punch.
    </p>

    {% if services_gallery %}
      <div class="ts-services__gallery" aria-label="Recent tile work examples">
        {% for photo in services_gallery %}
          {% assign webp_src = photo.src | replace: '.jpg', '.webp' | replace: '.png', '.webp' %}
          <figure class="ts-services__photo">
            <picture>
              {% if webp_src %}
                <source type="image/webp" srcset="{{ webp_src | relative_url }}">
              {% endif %}
              <img src="{{ photo.src | relative_url }}"
                   alt="{{ photo.alt | default: 'Tile installation detail' }}"
                   {% if photo.width and photo.height %}width="{{ photo.width }}" height="{{ photo.height }}"{% endif %}
                   loading="lazy" decoding="async"
                   sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw">
            </picture>
            {% if photo.caption %}
              <figcaption>{{ photo.caption }}</figcaption>
            {% endif %}
          </figure>
        {% endfor %}
      </div>
    {% else %}
      <div class="ts-services__gallery" aria-label="Recent tile work examples">
        <figure class="ts-services__photo">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-marble-shower-niche.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-marble-shower-niche.jpg' | relative_url }}"
                 alt="Marble-look shower with mosaic niche and window returns." loading="lazy" decoding="async">
          </picture>
          <figcaption>Curbless shower rebuild with sealed shelf, window trims, and waterproof documentation.</figcaption>
        </figure>

        <figure class="ts-services__photo">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-remodel-finished.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-remodel-finished.webp' | relative_url }}"
                 alt="Tile shower surround with matte black fixtures." loading="lazy" decoding="async">
          </picture>
          <figcaption>Finished remodel: waterproof tile, marble trim, and curated fixtures ready for handoff.</figcaption>
        </figure>

        <figure class="ts-services__photo ts-services__photo--rotate">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-accent-wall-and-shower.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-accent-wall-and-shower.jpg' | relative_url }}"
                 alt="Mid-stage view of the accent wall and shower layout." loading="lazy" decoding="async">
          </picture>
          <figcaption>Mid-stage: tile panels staged and waterproofing confirmed before grout.</figcaption>
        </figure>

        <figure class="ts-services__photo ts-services__photo--rotate">
          <picture>
            <source type="image/webp" srcset="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-accent-wall-detail.webp' | relative_url }}">
            <img src="{{ '/assets/img/tillerstead-work/bathrooms/bathroom-accent-wall-detail.jpg' | relative_url }}"
                 alt="Finished accent wall and shower detail." loading="lazy" decoding="async">
          </picture>
          <figcaption>Final detail: polished accent wall with step shelf and flush grout joints.</figcaption>
        </figure>
      </div>
    {% endif %}
  </div>
</section>
